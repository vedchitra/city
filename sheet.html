<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Profile ID & Date Viewer</title>
  <style>
    body{font-family: Arial; padding:20px}
    .controls{margin-bottom:16px}
    .sheet{margin-bottom:18px; border:1px solid #ddd; padding:12px; border-radius:6px}
    .title{font-weight:700; margin-bottom:8px}
    table{border-collapse:collapse; width:100%}
    th,td{border:1px solid #eee; padding:6px; text-align:left; font-size:13px}
    button{margin-left:8px}
  </style>
</head>
<body>
  <h2>All Sheets — Profile ID & Date</h2>

  <div class="controls">
    <label>Select Date: <input type="date" id="dateFilter"></label>
    <button id="clearBtn" type="button">Clear</button>
    <span id="totalCount" style="margin-left:18px; font-weight:700">Total Rows: 0</span>
  </div>

  <div id="container"></div>

<script>
/* === बदलायचे === */
const sheets = [
  {id:"18-ppYoq7PrYboz3WerRChDzokv5K-_Eo9OmyB2mCTuQ", gid:"0", name:"Sheet 1"},
  {id:"1_Eo4YYY2DkNwmSyMk52xvy4d_km9fTIjQcY4dAXL_-w", gid:"0", name:"Sheet 2"},
  // ... बाकी 20 IDs
];
/* ================= */

const container = document.getElementById('container');
const totalCountEl = document.getElementById('totalCount');
let allData = []; // {sheetName, rows:[{profile,date}]}

function pad(n){ return String(n).padStart(2,'0'); }
function normalizeDateCell(cell){
  if(!cell) return null;
  let s = String(cell).trim();
  if(!s) return null;
  s = s.split(' ')[0]; // remove time if exists
  let m = s.match(/^(\d{4})[-\/](\d{1,2})[-\/](\d{1,2})$/);
  if(m) return `${m[1]}-${pad(m[2])}-${pad(m[3])}`;
  m = s.match(/^(\d{1,2})[-\/](\d{1,2})[-\/](\d{4})$/);
  if(m) return `${m[3]}-${pad(m[2])}-${pad(m[1])}`;
  const dt = new Date(s);
  if(!isNaN(dt.getTime())) return `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())}`;
  return null;
}

function csvToArray(text){
  const rows=[], lines=text.split(/\r?\n/);
  for(const line of lines){
    if(line.trim()==='') continue;
    const row=[]; let cur='', inQuote=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch === '"'){
        if(inQuote && line[i+1] === '"'){ cur+='"'; i++; }
        else inQuote=!inQuote;
      } else if(ch === ',' && !inQuote){
        row.push(cur); cur='';
      } else cur+=ch;
    }
    row.push(cur); rows.push(row);
  }
  return rows;
}

async function fetchAndStore(sheet){
  const url = `https://docs.google.com/spreadsheets/d/${sheet.id}/export?format=csv&gid=${sheet.gid||0}`;
  try{
    const resp = await fetch(url);
    const text = await resp.text();
    const rows = csvToArray(text);
    if(rows.length>0){
      const headers = rows[0];
      const profileIdx = headers.findIndex(h => /profile id/i.test(h));
      const dateIdx = headers.findIndex(h => /^date$/i.test(h) || /Date/i.test(h));
      if(profileIdx<0 || dateIdx<0) return;
      const dataRows = rows.slice(1).map(r=>({
        profile: r[profileIdx] || "",
        date: r[dateIdx] || ""
      }));
      allData.push({sheetName: sheet.name, rows: dataRows});
    }
  }catch(e){
    console.error("Fetch error:", e);
  }
}

function renderData(filterDate){
  container.innerHTML=''; let total=0;
  allData.forEach(data=>{
    const block=document.createElement('div'); block.className='sheet';
    const title=document.createElement('div'); title.className='title'; title.textContent=data.sheetName;
    block.appendChild(title);

    const table=document.createElement('table');
    const thead=document.createElement('thead');
    thead.innerHTML='<tr><th>Profile ID</th><th>Date</th></tr>';
    table.appendChild(thead);
    const tbody=document.createElement('tbody');

    data.rows.forEach(r=>{
      const norm = normalizeDateCell(r.date);
      if(filterDate && norm !== filterDate) return;
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.profile}</td><td>${r.date}</td>`;
      tbody.appendChild(tr); total++;
    });

    table.appendChild(tbody);
    block.appendChild(table); container.appendChild(block);
  });
  totalCountEl.textContent = `Total Rows: ${total}`;
}

(async()=>{
  for(const s of sheets) await fetchAndStore(s);
  renderData(null);
})();

document.getElementById('dateFilter').addEventListener('change',e=>{
  renderData(e.target.value || null);
});
document.getElementById('clearBtn').addEventListener('click',()=>{
  document.getElementById('dateFilter').value='';
  renderData(null);
});
</script>
</body>
</html>
