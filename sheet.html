<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Profile ID & Date Viewer</title>
  <style>
    body{font-family: Arial; padding:20px}
    .controls{margin-bottom:16px}
    .sheet{margin-bottom:18px; border:1px solid #ddd; padding:12px; border-radius:6px}
    .title{font-weight:700; margin-bottom:8px}
    table{border-collapse:collapse; width:100%}
    th,td{border:1px solid #eee; padding:6px; text-align:left; font-size:13px}
    button{margin-left:8px}
  </style>
</head>
<body>
  <h2>All Sheets — Profile ID & Date</h2>

  <div class="controls">
    <label>Select Date: <input type="date" id="dateFilter"></label>
    <button id="clearBtn" type="button">Clear</button>
    <span id="totalCount" style="margin-left:18px; font-weight:700">Total Rows: 0</span>
  </div>

  <div id="container"></div>

<script>
/* === बदलायचे === */
const sheets = [
  { name: "Shahuwadi", id: "184PPKvazoKQbVyjuwoSlhHw9nWxZzKD1yN6IoAOJJzg" }, 
  { name: "Malakapur", id: "18ZQE0ceFMnTxthsie90iSprQIBtjOVxZcBkN1t8my9s" },
  { name: "Panhala", id: "1JLbzLErvzORcGktxMtR-vKk63swOAguTcgyQ_-Ag4Sg" },
  { name: "Hatkanangale", id: "1PyfPbGbYo9GrXYlTPjrJx6VCDECcDRUnP7K5WzOzG0Y" },
  { name: "Hupari", id: "1KW9ly61UByqqkpiv_tlS5kTY88OyF4pvespMLU90EZU" },
  { name: "Ichalkaranji", id: "1QsTm2yDBbjguGX91wEHDp-HTMG6Nq9Ei9aqwhh8DK_Y" },
  { name: "Shirol", id: "1Bz4LvHA1_O0tVLWhSCopHzf9-speKUmWSwQ4ALroMJk" },
  { name: "Jaysingpur", id: "1QxZtBMYC6VoMDFbndEhrBsnhGhFQeFR63PPqtTA40bs" },
  { name: "Kurundwad", id: "1wooggV3dUYscwIkeIOneR_40vSOQUV8CfdS4EOqFyp8" },
  { name: "Vadgaon", id: "1H-D2VhI34xJ7CXsY7ApdM3TEXTdQokpTTlzx2LmOL9c" },
  { name: "Kolhapur", id: "1diYjkoyiEdpJSVbSrG4oMwjdcwH9aLGqwsE3kYTBLGc" },
  { name: "Gaganbavada", id: "1NTjkx10bgJrt9DEKu9xTHqA1950LVInG8V-tNAbwA6I" },
  { name: "Radhanagari", id: "1bc63NXzw5ntqGjoKzxvHSTPZKRjRwr995kV9kIgVbIM" },
  { name: "Kagal", id: "1dxuDdJ7s-s2HJHEJTKO0yxsK1_PBTsCk7kthixVASAc" },
  { name: "Murgud", id: "1CYJSLmtU9bFTdaVTa_k49ssZ-G8kpJ31yuu8URCCZ0Q" },
  { name: "Gargoti", id: "1rjEJp0wqH31LJLj-6mVwnVx5ZNQbmtn06Zfi437MFs8" },
  { name: "Ajara", id: "1D1rgMthzfXM5V2fdJ6C-g69zlPcQVtsjnzxS77I9RqM" },
  { name: "Uttur", id: "1hSee6oP0_Osf90jcs7qcEsBqnuHzqVTxcD6jehdgXfQ" },
  { name: "Gadhinglaj", id: "1K8-y10WxtdTya8VMa8SHrse_smDZe4bY8vZG-7M0LGg" },
  { name: "Mahagaon", id: "1FdPvBvWDNYUgrEwj4MKpLIkPPCvaSdcMNF-nw-hOS_Y" },
  { name: "Nesari", id: "1oDkHSaIDGAHb5alUJ1ejxeFteKfDpV0ZC4YD-u7NhBs" },
  { name: "Chandgad", id: "1LL18YnPXBZK97aRwEveYoXldudXs-bjYY2PbUDozCgE" },
  { name: "Kowad", id: "1OePOsGmHVPJdHDm7kOre6qVmOpuUgBYjve1BHpVlLMU" },
  { name: "Halkarni Phata", id: "1fTWJqi-gUQ4yoYSLzXnbwfSstpN9nnCAemNjMrDSvIg" },
  { name: "Adkur", id: "1Qy4HHzTePbvGGob2Xkq3rAKCSgAW4rlBHanFrB8H60I" },
  { name: "Mangaon", id: "17MYp6bE9iNMscBh_1VvMtAwhI0iwyFi2LNobgzWCsQk" }
];
/* ================= */

const container = document.getElementById('container');
const totalCountEl = document.getElementById('totalCount');
let allData = []; // {sheetName, rows:[{profile,date}]}

function pad(n){ return String(n).padStart(2,'0'); }
function normalizeDateCell(cell){
  if(!cell) return null;
  let s = String(cell).trim();
  if(!s) return null;
  s = s.split(' ')[0]; // remove time if exists
  let m = s.match(/^(\d{4})[-\/](\d{1,2})[-\/](\d{1,2})$/);
  if(m) return `${m[1]}-${pad(m[2])}-${pad(m[3])}`;
  m = s.match(/^(\d{1,2})[-\/](\d{1,2})[-\/](\d{4})$/);
  if(m) return `${m[3]}-${pad(m[2])}-${pad(m[1])}`;
  const dt = new Date(s);
  if(!isNaN(dt.getTime())) return `${dt.getFullYear()}-${pad(dt.getMonth()+1)}-${pad(dt.getDate())}`;
  return null;
}

function csvToArray(text){
  const rows=[], lines=text.split(/\r?\n/);
  for(const line of lines){
    if(line.trim()==='') continue;
    const row=[]; let cur='', inQuote=false;
    for(let i=0;i<line.length;i++){
      const ch=line[i];
      if(ch === '"'){
        if(inQuote && line[i+1] === '"'){ cur+='"'; i++; }
        else inQuote=!inQuote;
      } else if(ch === ',' && !inQuote){
        row.push(cur); cur='';
      } else cur+=ch;
    }
    row.push(cur); rows.push(row);
  }
  return rows;
}

async function fetchAndStore(sheet){
  const url = `https://docs.google.com/spreadsheets/d/${sheet.id}/export?format=csv&gid=${sheet.gid||0}`;
  try{
    const resp = await fetch(url);
    const text = await resp.text();
    const rows = csvToArray(text);
    if(rows.length>0){
      const headers = rows[0];
      const profileIdx = headers.findIndex(h => /profile id/i.test(h));
      const dateIdx = headers.findIndex(h => /^date$/i.test(h) || /Date/i.test(h));
      if(profileIdx<0 || dateIdx<0) return;
      const dataRows = rows.slice(1).map(r=>({
        profile: r[profileIdx] || "",
        date: r[dateIdx] || ""
      }));
      allData.push({sheetName: sheet.name, rows: dataRows});
    }
  }catch(e){
    console.error("Fetch error:", e);
  }
}

function renderData(filterDate){
  container.innerHTML=''; let total=0;
  allData.forEach(data=>{
    const block=document.createElement('div'); block.className='sheet';
    const title=document.createElement('div'); title.className='title'; title.textContent=data.sheetName;
    block.appendChild(title);

    const table=document.createElement('table');
    const thead=document.createElement('thead');
    thead.innerHTML='<tr><th>Profile ID</th><th>Date</th></tr>';
    table.appendChild(thead);
    const tbody=document.createElement('tbody');

    data.rows.forEach(r=>{
      const norm = normalizeDateCell(r.date);
      if(filterDate && norm !== filterDate) return;
      const tr=document.createElement('tr');
      tr.innerHTML=`<td>${r.profile}</td><td>${r.date}</td>`;
      tbody.appendChild(tr); total++;
    });

    table.appendChild(tbody);
    block.appendChild(table); container.appendChild(block);
  });
  totalCountEl.textContent = `Total Rows: ${total}`;
}

(async()=>{
  for(const s of sheets) await fetchAndStore(s);
  renderData(null);
})();

document.getElementById('dateFilter').addEventListener('change',e=>{
  renderData(e.target.value || null);
});
document.getElementById('clearBtn').addEventListener('click',()=>{
  document.getElementById('dateFilter').value='';
  renderData(null);
});
</script>
</body>
</html>

